{"singlePage": [], "startSite": "", "filingNum": "", "onePageListNum": 15, "commentLabelColor": "#006b75", "yearColorList": ["#bc4c00", "#0969da", "#1f883d", "#A333D0"], "i18n": "CN", "themeMode": "manual", "dayTheme": "light", "nightTheme": "dark", "urlMode": "pinyin", "script": "", "style": "", "head": "", "indexScript": "", "indexStyle": "", "bottomText": "", "showPostSource": 1, "iconList": {}, "UTC": 8, "rssSplit": "sentence", "exlink": {}, "needComment": 1, "allHead": "", "title": "Blog Title", "subTitle": "Blog description", "avatarUrl": "https://github.githubassets.com/favicons/favicon.svg", "GMEEK_VERSION": "last", "postListJson": {"P2": {"htmlDir": "docs/post/windows-xia-vscode+cuda+torch-pei-zhi.html", "labels": ["\u914d\u7f6e"], "postTitle": "windows\u4e0bvscode+cuda+torch\u914d\u7f6e", "postUrl": "post/windows-xia-vscode%2Bcuda%2Btorch-pei-zhi.html", "postSourceUrl": "https://github.com/awsl12581/awsl12581.github.io/issues/2", "commentNum": 0, "wordCount": 8330, "description": "# 1.\u5b89\u88c5\u4e86pytorch\u7684python\u865a\u62df\u73af\u5883\r\n\r\n![](https://cdn.nlark.com/yuque/0/2024/png/21764230/1728436575784-8e0fb0af-c4e4-484b-a7a9-3e96f07f8a66.png)\r\n\r\n# 2.cmake\u6587\u4ef6\r\n\r\n```cmake\r\ncmake_minimum_required(VERSION 3.22)\r\nproject(paperscuda LANGUAGES CUDA CXX)\r\n\r\nset(CMAKE_EXPORT_COMPILE_COMMANDS ON )\r\nset(CMAKE_CXX_STANDARD 17)\r\nset(CMAKE_CXX_STANDARD_REQUIRED ON)\r\nset(CMAKE_CXX_EXTENSIONS ON)\r\n\r\n# use cudnn for cuda >12.0\r\n# set(CAFFE2_USE_CUDNN 1)\r\nset(CAFFE2_USE_CUDNN ON)\r\n\r\n# if(MSVC)\r\n#     add_compile_options('/source-charset:utf-8')\r\n#     add_compile_options('/execution-charset:gbk')\r\n# endif(MSVC)\r\n\r\n\r\nset(Python_ROOT_DIR '${CMAKE_SOURCE_DIR}/.venv')\r\n\r\n# find python Interpreter\r\n# find_package(Python3 COMPONENTS Interpreter)\r\nfind_package(Python COMPONENTS Interpreter Development)\r\nmessage(STATUS 'Python interpreter: ${Python_EXECUTABLE}')\r\n\r\nmessage(STATUS ${Python_INCLUDE_DIRS})\r\n\r\ninclude_directories(.)\r\n\r\nset(Torch_DIR ${Python_ROOT_DIR}/Lib/site-packages/torch/share/cmake/Torch)\r\nfind_package(Torch REQUIRED)\r\n\r\nmessage(STATUS ${CUDA_nvrtc_LIBRARY})\r\n\r\nadd_executable(main main.cu)\r\n# add_executable(matmul matmul.cu)\r\nmessage(STATUS ${TORCH_LIBRARIES})\r\n# lib link\r\ntarget_link_libraries(main ${TORCH_LIBRARIES})\r\n\r\n# add dll to binary\r\n# \u5b9a\u4e49lib\u6587\u4ef6\u5939\u8def\u5f84\r\nset(LIB_DIR ${Python_ROOT_DIR}/Lib/site-packages/torch/lib)\r\n\r\n# \u8bbe\u7f6e\u76ee\u6807\u4e8c\u8fdb\u5236\u8f93\u51fa\u76ee\u5f55\r\nset(BINARY_DIR ${PROJECT_BINARY_DIR})\r\n\r\n# \u67e5\u627e\u6240\u6709 .dll \u6587\u4ef6\uff0c\u6392\u9664 .lib \u6587\u4ef6\r\nfile(GLOB DLL_FILES '${LIB_DIR}/*.dll')\r\n\r\n# \u6dfb\u52a0\u81ea\u5b9a\u4e49\u547d\u4ee4\uff0c\u5728 POST_BUILD \u9636\u6bb5\u6267\u884c\r\nadd_custom_command(TARGET main POST_BUILD\r\n    COMMAND ${CMAKE_COMMAND} -E make_directory ${BINARY_DIR}  # \u786e\u4fdd\u76ee\u6807\u76ee\u5f55\u5b58\u5728\r\n    COMMAND ${CMAKE_COMMAND} -E copy_if_different ${DLL_FILES} ${BINARY_DIR}  # \u590d\u5236\u6240\u6709 .dll \u6587\u4ef6\u5230\u76ee\u6807\u76ee\u5f55\r\n)\r\n# add_library(paperscuda SHARED library.cu)\r\n\r\n# set_target_properties(main PROPERTIES\r\n#         CUDA_SEPARABLE_COMPILATION ON)\r\n\r\n```\r\n\r\nmain.cu\r\n\r\n```cpp\r\n#include <iostream>\r\n#include <cuda_runtime.h>\r\n#include 'device_launch_parameters.h'\r\n#include <torch/torch.h> // libtorch\r\n\r\nusing namespace torch; // libtorch\r\nusing namespace std;\r\n\r\n__global__ void matmul_gpu(float *A, float *B, float *C, int m, int k, int n)\r\n{\r\n    int row = blockIdx.y * blockDim.y + threadIdx.y;\r\n    int col = blockIdx.x * blockDim.x + threadIdx.x;\r\n\r\n    if (row < m && col < n)\r\n    {\r\n        float sum = 0.0f;\r\n        for (int l = 0; l < k; l++)\r\n        {\r\n            sum += A[row * k + l] * B[l * n + col];\r\n        }\r\n        C[row * n + col] = sum;\r\n    }\r\n}\r\n\r\nint main()\r\n{\r\n    cout << torch::cuda::is_available() << endl;\r\n    cout << torch::cuda::cudnn_is_available() << endl;\r\n    cout << torch::cuda::device_count() << endl;\r\n    return 0;\r\n}\r\n```\r\n\r\n\u4e00\u4e2a\u5408\u9002\u7684cmake\u7f16\u8bd1\u8f93\u51fa\u6587\u4ef6\uff1a\r\n\r\n```plain\r\n[main] \u6b63\u5728\u914d\u7f6e\u9879\u76ee: paperscuda \r\n[proc] \u6267\u884c\u547d\u4ee4: 'C:\\Program Files\\CMake\\bin\\cmake.EXE' -DCMAKE_BUILD_TYPE:STRING=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS:BOOL=TRUE --no-warn-unused-cli -SD:/GitHub/paperscuda -Bd:/GitHub/paperscuda/build -G Ninja\r\n[cmake] Not searching for unused variables given on the command line.\r\n[cmake] -- Python interpreter: D:/GitHub/paperscuda/.venv/Scripts/python.exe\r\n[cmake] -- C:/Users/Administrator/AppData/Local/Programs/Python/Python310/include\r\n[cmake] -- Caffe2: CUDA detected: 12.6\r\n[cmake] -- Caffe2: CUDA nvcc is: C:/Program Files/NVIDIA GPU Computing Toolkit/CUDA/v12.6/bin/nvcc.exe\r\n[cmake] -- Caffe2: CUDA toolkit directory: C:/Program Files/NVIDIA GPU Computing Toolkit/CUDA/v12.6\r\n[cmake] -- Caffe2: Header version is: 12.6\r\n[cmake] -- C:/Program Files/NVIDIA GPU Computing Toolkit/CUDA/v12.6/lib/x64/nvrtc.lib shorthash is bac8224f\r\n[cmake] -- USE_CUSPARSELT is set to 0. Compiling without cuSPARSELt support\r\n[cmake] -- Autodetected CUDA architecture(s):  6.1\r\n[cmake] -- Added CUDA NVCC flags for: -gencode;arch=compute_61,code=sm_61\r\n[cmake] -- C:/Program Files/NVIDIA GPU Computing Toolkit/CUDA/v12.6/lib/x64/nvrtc.lib\r\n[cmake] -- torchtorch_libraryD:/GitHub/paperscuda/.venv/Lib/site-packages/torch/lib/c10.libD:/GitHub/paperscuda/.venv/Lib/site-packages/torch/lib/kineto.libC:\\Program Files\\NVIDIA Corporation\\NvToolsExt\\/lib/x64/nvToolsExt64_1.libC:/Program Files/NVIDIA GPU Computing Toolkit/CUDA/v12.6/lib/x64/cudart_static.libD:/GitHub/paperscuda/.venv/Lib/site-packages/torch/lib/caffe2_nvrtc.libD:/GitHub/paperscuda/.venv/Lib/site-packages/torch/lib/c10_cuda.lib\r\n[cmake] -- Configuring done (8.6s)\r\n[cmake] -- Generating done (0.0s)\r\n[cmake] -- Build files have been written to: D:/GitHub/paperscuda/build\r\n```\r\n\r\n# 3.\u8865\u5145\u8bf4\u660e\r\n\r\n## 1.\u5173\u4e8efind_package(Python3 COMPONENTS Interpreter)\r\n\r\n\u5bfc\u5165torch\u9700\u8981\u67e5\u627e\u5230python\u89e3\u91ca\u5668\u548c\u5e93\u7684\u4f4d\u7f6e\uff08\u8fd9\u6765\u6e90\u4e8ecaffe\u9700\u8981\u501f\u52a9python\u6765\u8ba1\u7b97\u5e93\u6587\u4ef6\u7684hash\u503c\uff09\uff0c\u5728\u542f\u7528\u4e86virtualvenv\u65f6\uff0c\u6211\u4eec\u5e0c\u671b\u627e\u5230venv\u7684\u89e3\u91ca\u5668\u5730\u5740\u3002", "top": 0, "createdAt": 1731811308, "style": "", "script": "", "head": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-11-17", "dateLabelColor": "#bc4c00"}}, "singeListJson": {}, "labelColorDict": {"bug": "#d73a4a", "documentation": "#0075ca", "duplicate": "#cfd3d7", "enhancement": "#a2eeef", "good first issue": "#7057ff", "help wanted": "#008672", "invalid": "#e4e669", "question": "#d876e3", "wontfix": "#ffffff", "\u6d4b\u8bd5": "#8CC203", "\u914d\u7f6e": "#006b75"}, "displayTitle": "Blog Title", "faviconUrl": "https://github.githubassets.com/favicons/favicon.svg", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "primerCSS": "<link href='https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/Primer/21.0.7/primer.css' rel='stylesheet' />", "homeUrl": "https://awsl12581.github.io", "prevUrl": "disabled", "nextUrl": "disabled"}